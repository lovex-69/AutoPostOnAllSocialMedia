<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ExecutionPosting</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#fafbfc;--surface:#fff;--surface-2:#f4f5f7;--border:#e2e4e9;
  --text:#1a1d23;--text-dim:#6b7280;--accent:#5046e5;--accent-light:#ede9fe;
  --accent-glow:rgba(80,70,229,.18);--green:#059669;--green-bg:#ecfdf5;
  --red:#dc2626;--red-bg:#fef2f2;--amber:#d97706;--amber-bg:#fffbeb;
  --blue:#2563eb;--blue-bg:#eff6ff;
  --radius:12px;--shadow:0 1px 3px rgba(0,0,0,.06),0 1px 2px rgba(0,0,0,.04);
  --shadow-lg:0 4px 20px rgba(0,0,0,.08);--transition:.2s ease;
  --font:'Inter',system-ui,-apple-system,sans-serif;
}
body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.6;min-height:100vh}
a{color:var(--accent);text-decoration:none}
a:hover{text-decoration:underline}

/* â”€â”€ Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.gate{position:fixed;inset:0;background:var(--bg);display:flex;align-items:center;justify-content:center;z-index:1000;transition:opacity .5s}
.gate.hidden{opacity:0;pointer-events:none}
.gate-box{text-align:center;max-width:380px;padding:2rem}
.gate-box h1{font-size:1.8rem;font-weight:800;color:var(--accent);margin-bottom:.3rem}
.gate-box p{color:var(--text-dim);font-size:.88rem;margin-bottom:1.5rem}
.gate-status{font-size:.82rem;font-weight:600;min-height:1.5rem;margin-bottom:1.2rem;display:flex;align-items:center;justify-content:center;gap:.4rem}
.input{width:100%;padding:.65rem .9rem;border:1.5px solid var(--border);border-radius:8px;font:inherit;font-size:.9rem;color:var(--text);background:var(--surface);outline:none;transition:border var(--transition)}
.input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow)}
.textarea{resize:vertical;min-height:64px}

/* â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:.4rem;padding:.6rem 1.2rem;font:inherit;font-size:.88rem;font-weight:600;border:none;border-radius:8px;cursor:pointer;transition:all var(--transition)}
.btn-primary{background:var(--accent);color:#fff;box-shadow:0 1px 3px rgba(80,70,229,.3)}
.btn-primary:hover{background:#4338ca;transform:translateY(-1px);box-shadow:0 4px 12px rgba(80,70,229,.25)}
.btn-primary:active{transform:translateY(0)}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}
.btn-ghost{background:transparent;color:var(--text-dim);border:1.5px solid var(--border)}
.btn-ghost:hover{border-color:var(--accent);color:var(--accent)}
.btn-xs{padding:.25rem .5rem;font-size:.72rem;border-radius:6px}
.btn-green{background:var(--green-bg);color:var(--green);border:1px solid #d1fae5}
.btn-green:hover{background:#d1fae5}
.btn-red{background:var(--red-bg);color:var(--red);border:1px solid #fecaca}
.btn-red:hover{background:#fecaca}
.btn-full{width:100%}

/* â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.app{max-width:1140px;margin:0 auto;padding:1.5rem 1.2rem 4rem;display:none}
.topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;padding-bottom:1rem;border-bottom:1px solid var(--border)}
.topbar h1{font-size:1.3rem;font-weight:800;color:var(--accent)}
.topbar-right{display:flex;align-items:center;gap:.8rem}
.server-dot{width:8px;height:8px;border-radius:50%;display:inline-block}
.server-dot.on{background:var(--green)}
.server-dot.off{background:var(--red)}
.server-label{font-size:.78rem;font-weight:600;color:var(--text-dim)}

/* â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.nav{display:flex;gap:.25rem;margin-bottom:1.5rem;border-bottom:1.5px solid var(--border);overflow-x:auto}
.nav-btn{padding:.55rem 1rem;font:inherit;font-size:.82rem;font-weight:600;color:var(--text-dim);background:none;border:none;border-bottom:2px solid transparent;cursor:pointer;white-space:nowrap;transition:all var(--transition)}
.nav-btn:hover{color:var(--text)}
.nav-btn.active{color:var(--accent);border-bottom-color:var(--accent)}
.tab{display:none}.tab.active{display:block}

/* â”€â”€ Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;box-shadow:var(--shadow)}
.card-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.2rem}
.card-title{font-size:1rem;font-weight:700}

/* â”€â”€ Grid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.grid-2{display:grid;grid-template-columns:1fr 1.4fr;gap:1.5rem;align-items:start}
@media(max-width:860px){.grid-2{grid-template-columns:1fr}}

/* â”€â”€ Form â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.field{margin-bottom:.9rem}
.field label{display:block;font-size:.75rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.3rem}

/* â”€â”€ Segment â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.segment{display:flex;background:var(--surface-2);border-radius:8px;padding:3px;gap:2px;margin-bottom:.8rem}
.segment button{flex:1;padding:.4rem;font:inherit;font-size:.8rem;font-weight:600;border:none;background:transparent;color:var(--text-dim);border-radius:6px;cursor:pointer;transition:all var(--transition)}
.segment button.active{background:var(--surface);color:var(--text);box-shadow:var(--shadow)}

/* â”€â”€ Drop zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.drop{border:2px dashed var(--border);border-radius:10px;padding:1.5rem;text-align:center;cursor:pointer;color:var(--text-dim);font-size:.84rem;transition:all var(--transition)}
.drop:hover,.drop.over{border-color:var(--accent);background:var(--accent-light)}
.drop input{display:none}
.drop .selected{color:var(--green);font-weight:600;margin-top:.3rem}

/* â”€â”€ Video info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.vid-info{background:var(--surface-2);border-radius:8px;padding:.8rem;font-size:.78rem;margin-top:.5rem}
.vid-info-grid{display:grid;grid-template-columns:auto 1fr;gap:.2rem .6rem}
.vid-info-label{color:var(--text-dim);font-weight:600}
.vid-warn{color:var(--amber);font-size:.76rem;margin-top:.3rem}

/* â”€â”€ Tool cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tool-list{display:flex;flex-direction:column;gap:.6rem;max-height:600px;overflow-y:auto;padding-right:.3rem}
.tool-card{display:flex;align-items:center;gap:.8rem;padding:.8rem;background:var(--surface-2);border-radius:10px;border:1px solid transparent;transition:all var(--transition)}
.tool-card:hover{border-color:var(--border);box-shadow:var(--shadow)}
.progress-ring{flex-shrink:0}
.progress-ring circle{transition:stroke-dashoffset .5s ease}
.tool-body{flex:1;min-width:0}
.tool-name{font-size:.88rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.tool-meta{font-size:.72rem;color:var(--text-dim);display:flex;flex-wrap:wrap;gap:.3rem;margin-top:.15rem}
.tool-platforms{display:flex;gap:.2rem;margin-top:.2rem;flex-wrap:wrap}
.plat{font-size:.65rem;font-weight:700;padding:.1rem .35rem;border-radius:4px;text-transform:uppercase;letter-spacing:.3px}
.plat-ok{background:var(--green-bg);color:var(--green)}
.plat-fail{background:var(--red-bg);color:var(--red)}
.plat-wait{background:var(--surface-2);color:var(--text-dim);border:1px solid var(--border)}
.plat-skip{background:var(--surface-2);color:var(--text-dim);text-decoration:line-through}
.tool-actions{display:flex;gap:.3rem;flex-shrink:0}
.tool-error{font-size:.68rem;color:var(--red);margin-top:.2rem;word-break:break-word}
.tool-sched{font-size:.68rem;color:var(--amber);margin-top:.1rem}

/* â”€â”€ Badge â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.badge{display:inline-block;padding:.12rem .5rem;border-radius:99px;font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
.badge-ready{background:var(--blue-bg);color:var(--blue)}
.badge-posted{background:var(--green-bg);color:var(--green)}
.badge-failed{background:var(--red-bg);color:var(--red)}
.badge-draft{background:var(--surface-2);color:var(--text-dim)}

/* â”€â”€ Stats â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(120px,1fr));gap:.8rem;margin-bottom:1.5rem}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:1rem;text-align:center;box-shadow:var(--shadow)}
.stat-val{font-size:1.6rem;font-weight:800;color:var(--accent)}
.stat-label{font-size:.7rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:.4px;margin-top:.15rem}

/* â”€â”€ Progress bars â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.platform-row{display:flex;align-items:center;gap:.6rem;padding:.5rem 0;border-bottom:1px solid var(--surface-2)}
.platform-row:last-child{border-bottom:none}
.platform-row .name{min-width:70px;font-size:.82rem;font-weight:600}
.track{flex:1;height:6px;background:var(--surface-2);border-radius:3px;overflow:hidden}
.track-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent),var(--green));transition:width .5s}
.platform-row .rate{font-size:.78rem;font-weight:700;min-width:40px;text-align:right}

/* â”€â”€ Heatmap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.heatmap-wrap{margin-top:1.5rem}
.heatmap-title{font-size:.88rem;font-weight:700;margin-bottom:.6rem;display:flex;align-items:center;gap:.4rem}
.heatmap{display:flex;gap:2px;overflow-x:auto;padding-bottom:.5rem}
.heatmap-col{display:flex;flex-direction:column;gap:2px}
.heatmap-cell{width:12px;height:12px;border-radius:2px;background:var(--surface-2);border:1px solid var(--border);cursor:default;transition:transform .15s}
.heatmap-cell:hover{transform:scale(1.5);z-index:1}
.heatmap-cell[data-lvl="1"]{background:#c7d2fe;border-color:#a5b4fc}
.heatmap-cell[data-lvl="2"]{background:#818cf8;border-color:#6366f1}
.heatmap-cell[data-lvl="3"]{background:#6366f1;border-color:#4f46e5}
.heatmap-cell[data-lvl="4"]{background:#4f46e5;border-color:#4338ca}
.heatmap-legend{display:flex;align-items:center;gap:.3rem;margin-top:.5rem;font-size:.7rem;color:var(--text-dim)}
.heatmap-legend .cell{width:12px;height:12px;border-radius:2px;border:1px solid var(--border)}
.heatmap-months{display:flex;gap:2px;margin-bottom:.3rem;padding-left:0}
.heatmap-months span{font-size:.65rem;color:var(--text-dim);text-align:center}

/* â”€â”€ Token health â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.health-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:.8rem}
.health-card{background:var(--surface-2);border-radius:10px;padding:.9rem;border-left:3px solid var(--border)}
.health-card.ok{border-left-color:var(--green)}
.health-card.warn{border-left-color:var(--amber)}
.health-card.err{border-left-color:var(--red)}
.health-card h4{font-size:.85rem;font-weight:700;margin-bottom:.3rem}
.health-card .detail{font-size:.75rem;color:var(--text-dim)}

/* â”€â”€ Limits (inline in form) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.limits-inline{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:.5rem;margin-top:.5rem}
.limit-chip{background:var(--surface-2);border-radius:8px;padding:.5rem .6rem;font-size:.72rem}
.limit-chip strong{display:block;font-size:.78rem;margin-bottom:.15rem;color:var(--text)}
.limit-chip span{color:var(--text-dim)}

/* â”€â”€ Schedule sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sched-list{list-style:none}
.sched-item{display:flex;align-items:center;gap:.5rem;padding:.5rem .6rem;border-radius:8px;cursor:pointer;font-size:.78rem;transition:all var(--transition);border:1px solid transparent;margin-bottom:.3rem}
.sched-item:hover{background:var(--accent-light);border-color:var(--accent)}
.sched-item.prime{border-left:3px solid var(--green)}
.sched-time{font-weight:700;min-width:90px;color:var(--text)}
.sched-plat{color:var(--accent);font-weight:600;min-width:60px}
.sched-reason{color:var(--text-dim);flex:1}

/* â”€â”€ Toast â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.toast{position:fixed;bottom:1.5rem;right:1.5rem;padding:.8rem 1.2rem;border-radius:10px;font-size:.85rem;font-weight:600;transform:translateY(120%);opacity:0;transition:all .35s;z-index:999;max-width:380px;box-shadow:var(--shadow-lg)}
.toast.show{transform:translateY(0);opacity:1}
.toast.success{background:var(--green-bg);color:var(--green);border:1px solid #a7f3d0}
.toast.error{background:var(--red-bg);color:var(--red);border:1px solid #fca5a5}
.toast.warning{background:var(--amber-bg);color:var(--amber);border:1px solid #fde68a}

/* â”€â”€ Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;z-index:900;opacity:0;pointer-events:none;transition:opacity .25s}
.modal-bg.show{opacity:1;pointer-events:all}
.modal{background:var(--surface);border-radius:14px;padding:1.8rem;max-width:520px;width:92%;max-height:80vh;overflow-y:auto;box-shadow:var(--shadow-lg);transform:scale(.95);transition:transform .25s}
.modal-bg.show .modal{transform:scale(1)}
.modal h3{font-size:1rem;font-weight:700;margin-bottom:1rem}
.modal-foot{display:flex;gap:.6rem;justify-content:flex-end;margin-top:1.2rem}

/* â”€â”€ Warning items â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.warn-list{list-style:none;margin-bottom:1rem}
.warn-item{padding:.55rem .8rem;border-radius:8px;margin-bottom:.4rem;font-size:.82rem;display:flex;gap:.5rem;align-items:flex-start}
.warn-item.w-warn{background:var(--amber-bg);color:#92400e;border:1px solid #fde68a}
.warn-item.w-error{background:var(--red-bg);color:var(--red);border:1px solid #fca5a5}
.warn-item.w-info{background:var(--blue-bg);color:var(--blue);border:1px solid #bfdbfe}
.dup-box{background:var(--red-bg);border:1px solid #fca5a5;border-radius:8px;padding:.7rem;margin-bottom:.8rem;font-size:.8rem}
.dup-box strong{color:var(--red)}
.queue-chip{display:inline-flex;align-items:center;gap:.3rem;padding:.3rem .7rem;background:var(--accent-light);border-radius:6px;font-size:.75rem;color:var(--accent);font-weight:600;margin-top:.5rem}

/* â”€â”€ Bulk â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bulk-area textarea{min-height:180px;font-family:'JetBrains Mono',monospace;font-size:.8rem}

/* â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.confetti-piece{position:fixed;width:8px;height:8px;border-radius:2px;z-index:9999;pointer-events:none;animation:confetti-fall 1.5s ease-out forwards}
@keyframes confetti-fall{0%{opacity:1;transform:translateY(0) rotate(0deg)}100%{opacity:0;transform:translateY(100vh) rotate(720deg)}}

/* â”€â”€ Spinner â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.spin{display:inline-block;width:16px;height:16px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:sp .6s linear infinite}
.spin.white{border-color:rgba(255,255,255,.3);border-top-color:#fff}
@keyframes sp{to{transform:rotate(360deg)}}

/* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:600px){
  .app{padding:1rem .6rem 3rem}
  .topbar h1{font-size:1.1rem}
  .nav-btn{padding:.4rem .6rem;font-size:.76rem}
  .card{padding:1rem}
  .stats{grid-template-columns:repeat(2,1fr)}
  .health-grid{grid-template-columns:1fr}
  .limits-inline{grid-template-columns:1fr}
  .modal{padding:1.2rem;width:96%}
  .modal-foot{flex-direction:column}
  .modal-foot button{width:100%}
  .heatmap-cell{width:10px;height:10px}
}
</style>
</head>
<body>

<!-- â”€â”€ Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="gate" id="gate">
  <div class="gate-box">
    <h1>ExecutionPosting</h1>
    <p>Automated multi-platform distribution for AI tools</p>
    <div class="field" style="text-align:left;margin-bottom:1rem">
      <label>Access Key</label>
      <input type="password" class="input" id="gateKey" placeholder="Enter secret key"/>
    </div>
    <div class="gate-status" id="gateSt"><span class="spin"></span> Checking server...</div>
    <button class="btn btn-primary btn-full" id="gateBtn" onclick="wake()">Connect</button>
  </div>
</div>

<!-- â”€â”€ Warning Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="modal-bg" id="warnModal">
  <div class="modal">
    <h3>Review Before Posting</h3>
    <div id="warnBody"></div>
    <div class="modal-foot">
      <button class="btn btn-ghost" onclick="closeWarn()">Cancel</button>
      <button class="btn btn-primary" id="warnConfirm" onclick="forceSubmit()">Post Anyway</button>
    </div>
  </div>
</div>

<!-- â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="app" id="app">
  <div class="topbar">
    <h1>ExecutionPosting</h1>
    <div class="topbar-right">
      <span class="server-dot on" id="sDot"></span>
      <span class="server-label" id="sLabel">Online</span>
      <button class="btn btn-ghost btn-xs" style="color:var(--red)" onclick="logout()">Logout</button>
    </div>
  </div>

  <nav class="nav">
    <button class="nav-btn active" data-tab="tPost" onclick="nav('tPost',this)">Post</button>
    <button class="nav-btn" data-tab="tActivity" onclick="nav('tActivity',this)">Activity</button>
    <button class="nav-btn" data-tab="tAnalytics" onclick="nav('tAnalytics',this)">Analytics</button>
    <button class="nav-btn" data-tab="tHealth" onclick="nav('tHealth',this)">Health</button>
    <button class="nav-btn" data-tab="tBulk" onclick="nav('tBulk',this)">Bulk</button>
  </nav>

  <!-- â•â•â• POST TAB â•â•â• -->
  <div class="tab active" id="tPost">
    <div class="grid-2">
      <div>
        <!-- Form card -->
        <div class="card" style="margin-bottom:1rem">
          <div class="card-header"><span class="card-title">New Tool</span></div>
          <form id="frm">
            <div class="field"><label>Tool Name *</label><input class="input" id="fName" required placeholder="e.g. ChatGPT"/></div>
            <div class="field"><label>Handle</label><input class="input" id="fHandle" placeholder="@openai"/></div>
            <div class="field"><label>Description</label><textarea class="input textarea" id="fDesc" placeholder="Brief description..."></textarea></div>
            <div class="field"><label>Website</label><input class="input" id="fWeb" type="url" placeholder="https://..."/></div>

            <label style="font-size:.75rem;font-weight:600;color:var(--text-dim);text-transform:uppercase;letter-spacing:.5px;margin-bottom:.3rem;display:block">Video *</label>
            <div class="segment">
              <button type="button" class="active" id="segUrl" onclick="vidMode('url')">Paste URL</button>
              <button type="button" id="segFile" onclick="vidMode('file')">Upload</button>
            </div>
            <div class="field" id="urlField"><input class="input" id="fUrl" placeholder="https://example.com/video.mp4"/></div>
            <div id="fileField" style="display:none">
              <div class="drop" id="dropZone">
                <div>Drop MP4 here or <strong>click to browse</strong></div>
                <div class="selected" id="fFileName"></div>
                <input type="file" id="fFile" accept="video/mp4,video/quicktime,video/webm"/>
              </div>
              <div id="vidPreview" style="display:none"></div>
            </div>

            <div class="field" style="margin-top:.8rem">
              <label>Schedule (optional)</label>
              <input class="input" type="datetime-local" id="fSched" style="color-scheme:light"/>
              <div style="font-size:.7rem;color:var(--text-dim);margin-top:.2rem">Leave empty = post ASAP. <a href="#" onclick="event.preventDefault();nav('tPost',document.querySelector('[data-tab=tPost]'));document.getElementById('schedSidebar').scrollIntoView({behavior:'smooth'})">See best times â†“</a></div>
            </div>
            <button type="submit" class="btn btn-primary btn-full" id="submitBtn">Submit & Queue</button>
          </form>
        </div>

        <!-- Schedule suggestions (inline) -->
        <div class="card" id="schedSidebar">
          <div class="card-header"><span class="card-title">Best Times to Post</span><button class="btn btn-ghost btn-xs" onclick="loadSched()">Refresh</button></div>
          <div id="schedBox"><div style="text-align:center;padding:1rem;color:var(--text-dim)"><span class="spin"></span></div></div>
        </div>
      </div>

      <!-- Right: Tool list -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Queue</span>
          <button class="btn btn-ghost btn-xs" onclick="loadTools()">Refresh</button>
        </div>
        <div id="toolBox"><div style="text-align:center;padding:2rem;color:var(--text-dim)">No tools yet</div></div>
      </div>
    </div>

    <!-- Platform limits (collapsed) -->
    <details style="margin-top:1rem">
      <summary style="cursor:pointer;font-size:.82rem;font-weight:600;color:var(--text-dim)">Platform Video Limits</summary>
      <div id="limitsBox" style="margin-top:.5rem"></div>
    </details>
  </div>

  <!-- â•â•â• ACTIVITY TAB â•â•â• -->
  <div class="tab" id="tActivity">
    <div class="card">
      <div class="card-header"><span class="card-title">Posting Activity</span></div>
      <div id="heatmapBox"><div style="text-align:center;padding:2rem;color:var(--text-dim)"><span class="spin"></span> Loading heatmap...</div></div>
    </div>

    <div class="card" style="margin-top:1rem">
      <div class="card-header"><span class="card-title">Recent Posts</span></div>
      <div id="recentBox"><div style="text-align:center;padding:1rem;color:var(--text-dim)"><span class="spin"></span></div></div>
    </div>
  </div>

  <!-- â•â•â• ANALYTICS TAB â•â•â• -->
  <div class="tab" id="tAnalytics">
    <div class="card">
      <div class="card-header">
        <span class="card-title">Analytics</span>
        <button class="btn btn-green btn-xs" onclick="exportCSV()">Export CSV</button>
      </div>
      <div id="analyticsBox"><div style="text-align:center;padding:2rem;color:var(--text-dim)"><span class="spin"></span></div></div>
    </div>
  </div>

  <!-- â•â•â• HEALTH TAB â•â•â• -->
  <div class="tab" id="tHealth">
    <div class="card">
      <div class="card-header"><span class="card-title">Token & Service Health</span></div>
      <div id="healthBox"><div style="text-align:center;padding:2rem;color:var(--text-dim)"><span class="spin"></span></div></div>
    </div>
  </div>

  <!-- â•â•â• BULK TAB â•â•â• -->
  <div class="tab" id="tBulk">
    <div class="card bulk-area">
      <div class="card-header"><span class="card-title">Bulk Upload</span></div>
      <p style="color:var(--text-dim);font-size:.82rem;margin-bottom:.8rem">Paste a JSON array. Each object needs <code style="color:var(--accent)">tool_name</code> and <code style="color:var(--accent)">video_url</code>.</p>
      <div class="field"><textarea class="input textarea" id="bulkJson" style="min-height:180px;font-family:monospace" placeholder='[{"tool_name":"ChatGPT","video_url":"https://..."}]'></textarea></div>
      <button class="btn btn-primary btn-full" id="bulkBtn" onclick="bulkUp()">Upload All</button>
      <div id="bulkRes" style="margin-top:.8rem;font-size:.82rem"></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script src="config.js"></script>
<script>
const A = window.EXECUTION_API_URL || '';
let _pfd = null; // pending FormData for force-submit

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function auth() { return sessionStorage.getItem('ep_k') || ''; }
function hdr() { return {'X-Auth-Key': auth()}; }
function logout() { sessionStorage.removeItem('ep_k'); location.reload(); }
function esc(s) { if(!s) return ''; const d=document.createElement('div'); d.textContent=s; return d.innerHTML; }
function toast(m, t='success') { const e=document.getElementById('toast'); e.textContent=m; e.className=`toast ${t} show`; setTimeout(()=>e.classList.remove('show'),4000); }

// â”€â”€ Gate â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function chk() { try { const r=await fetch(`${A}/health`,{signal:AbortSignal.timeout(8000)}); return r.ok; } catch{return false;} }
async function chkAuth(k) { try { const r=await fetch(`${A}/api/tools`,{headers:{'X-Auth-Key':k},signal:AbortSignal.timeout(10000)}); return r.ok; } catch{return false;} }

(async()=>{
  const st=document.getElementById('gateSt'), btn=document.getElementById('gateBtn'), k=auth();
  const on=await chk();
  if(on&&k){if(await chkAuth(k)){enter();return;}}
  st.innerHTML=on?'<span style="color:var(--green)">â— Server online</span>':'<span style="color:var(--red)">â— Server sleeping</span>';
  btn.disabled=false;
})();

async function wake(){
  const st=document.getElementById('gateSt'),btn=document.getElementById('gateBtn'),k=document.getElementById('gateKey').value.trim();
  if(!k){st.innerHTML='<span style="color:var(--red)">Enter your access key</span>';return;}
  btn.disabled=true; btn.innerHTML='<span class="spin white"></span> Connecting...';
  st.innerHTML='<span class="spin"></span> Waking server...';
  const t=Date.now();
  while(Date.now()-t<90000){
    if(await chk()){
      if(await chkAuth(k)){sessionStorage.setItem('ep_k',k);enter();return;}
      else{st.innerHTML='<span style="color:var(--red)">Invalid key</span>';btn.disabled=false;btn.textContent='Connect';return;}
    }
    await new Promise(r=>setTimeout(r,5000));
  }
  st.innerHTML='<span style="color:var(--red)">Server didn\'t respond</span>';btn.disabled=false;btn.textContent='Connect';
}
document.getElementById('gateKey').addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();wake();}});

function enter(){
  document.getElementById('gate').classList.add('hidden');
  document.getElementById('app').style.display='block';
  loadTools(); loadSched(); loadLimits();
}

// â”€â”€ Server pulse â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(async()=>{
  const on=await chk();
  document.getElementById('sDot').className=`server-dot ${on?'on':'off'}`;
  document.getElementById('sLabel').textContent=on?'Online':'Sleeping';
},60000);

// â”€â”€ Nav â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nav(id,btn){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
  if(id==='tActivity'){loadHeatmap();loadRecent();}
  if(id==='tAnalytics')loadAnalytics();
  if(id==='tHealth')loadHealth();
}

// â”€â”€ Video mode toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function vidMode(m){
  document.getElementById('segUrl').classList.toggle('active',m==='url');
  document.getElementById('segFile').classList.toggle('active',m==='file');
  document.getElementById('urlField').style.display=m==='url'?'block':'none';
  document.getElementById('fileField').style.display=m==='file'?'block':'none';
  if(m==='url'){document.getElementById('fFile').value='';document.getElementById('vidPreview').style.display='none';}
  if(m==='file')document.getElementById('fUrl').value='';
}

// â”€â”€ Drop zone â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const dz=document.getElementById('dropZone'),fi=document.getElementById('fFile');
dz.addEventListener('click',()=>fi.click());
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('over');});
dz.addEventListener('dragleave',()=>dz.classList.remove('over'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('over');if(e.dataTransfer.files.length){fi.files=e.dataTransfer.files;onFile(fi.files[0]);}});
fi.addEventListener('change',()=>{if(fi.files.length)onFile(fi.files[0]);});

function onFile(f){
  document.getElementById('fFileName').textContent=f.name;
  const mb=(f.size/1048576).toFixed(1), prev=document.getElementById('vidPreview');
  let h=`<div class="vid-info"><div class="vid-info-grid"><span class="vid-info-label">File</span><span>${esc(f.name)}</span><span class="vid-info-label">Size</span><span>${mb} MB</span><span class="vid-info-label">Type</span><span>${f.type||'unknown'}</span></div>`;
  const w=[];
  if(+mb>512)w.push('Exceeds X/Twitter 512 MB limit');
  if(+mb>200)w.push('Exceeds LinkedIn 200 MB limit');
  if(!f.type.includes('mp4')&&!f.type.includes('video'))w.push('MP4 recommended');
  w.forEach(x=>{h+=`<div class="vid-warn">âš  ${x}</div>`;});
  const v=document.createElement('video');v.preload='metadata';
  v.onloadedmetadata=()=>{
    const d=v.duration;if(d&&isFinite(d)){
      const ds=d<60?d.toFixed(1)+'s':`${Math.floor(d/60)}m ${Math.floor(d%60)}s`;
      let dh=`<div style="margin-top:.3rem"><span class="vid-info-label">Duration</span> ${ds}</div>`;
      if(d>90)dh+=`<div class="vid-warn">âš  ${ds} â€” exceeds Reels (90s) & Shorts (60s)</div>`;
      else if(d>60)dh+=`<div class="vid-warn">âš  ${ds} â€” exceeds Shorts 60s limit</div>`;
      prev.querySelector('.vid-info').insertAdjacentHTML('beforeend',dh);
    }URL.revokeObjectURL(v.src);
  };v.src=URL.createObjectURL(f);
  h+='</div>'; prev.innerHTML=h; prev.style.display='block';
}

// â”€â”€ Submit â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('frm').addEventListener('submit',async e=>{
  e.preventDefault();
  const btn=document.getElementById('submitBtn'); btn.disabled=true; btn.innerHTML='<span class="spin white"></span> Validating...';
  try{
    const fd=new FormData(), name=document.getElementById('fName').value.trim();
    if(!name)throw new Error('Tool name required');
    fd.append('tool_name',name);
    const h=document.getElementById('fHandle').value.trim(); if(h)fd.append('handle',h);
    const d=document.getElementById('fDesc').value.trim(); if(d)fd.append('description',d);
    const w=document.getElementById('fWeb').value.trim(); if(w)fd.append('website',w);
    const url=document.getElementById('fUrl').value.trim(), file=document.getElementById('fFile').files[0];
    if(url)fd.append('video_url',url);else if(file)fd.append('video_file',file);else throw new Error('Video required');
    const sv=document.getElementById('fSched').value; if(sv)fd.append('scheduled_at',sv+':00Z');

    const r=await fetch(`${A}/api/tools`,{method:'POST',body:fd,headers:hdr()});
    const data=await r.json(); if(!r.ok)throw new Error(data.detail||'Failed');

    if(data.needs_confirmation){
      const fd2=new FormData(); fd2.append('tool_name',name);
      if(h)fd2.append('handle',h);if(d)fd2.append('description',d);if(w)fd2.append('website',w);
      if(url)fd2.append('video_url',url);else if(file)fd2.append('video_file',file);
      if(sv)fd2.append('scheduled_at',sv+':00Z');
      _pfd=fd2; showWarn(data); btn.innerHTML='Awaiting...'; return;
    }
    toast(`"${data.tool_name}" queued!`); confetti();
    if(data.queue_estimate)setTimeout(()=>toast(data.queue_estimate.message,'warning'),600);
    e.target.reset(); document.getElementById('fFileName').textContent=''; document.getElementById('vidPreview').style.display='none'; vidMode('url'); loadTools();
  }catch(err){toast(err.message,'error');}
  finally{if(!_pfd){btn.disabled=false;btn.textContent='Submit & Queue';}}
});

// â”€â”€ Warning modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showWarn(d){
  let h='';
  if(d.video_info&&Object.keys(d.video_info).length){
    const v=d.video_info, ds=v.duration_sec<60?v.duration_sec+'s':`${Math.floor(v.duration_sec/60)}m ${Math.floor(v.duration_sec%60)}s`;
    h+=`<div class="vid-info"><strong>Video Details</strong><div class="vid-info-grid" style="margin-top:.3rem"><span class="vid-info-label">Duration</span><span>${ds}</span><span class="vid-info-label">Size</span><span>${v.size_mb} MB</span><span class="vid-info-label">Resolution</span><span>${v.width}x${v.height}</span><span class="vid-info-label">Codec</span><span>${v.codec}</span><span class="vid-info-label">Orientation</span><span>${v.is_vertical?'Vertical âœ“':'Landscape'}</span></div></div>`;
  }
  if(d.warnings&&d.warnings.length){h+=`<ul class="warn-list">`;d.warnings.forEach(w=>{const s=w.severity||'warning',i=s==='error'?'ğŸš¨':s==='warning'?'âš ï¸':'â„¹ï¸';h+=`<li class="warn-item w-${s}"><span>${i}</span><span>${esc(w.message)}</span></li>`;});h+=`</ul>`;}
  if(d.duplicates&&d.duplicates.length){h+=`<div class="dup-box"><strong>Duplicate Content Detected</strong>`;d.duplicates.forEach(x=>{h+=`<div style="margin-top:.3rem;color:var(--text-dim);font-size:.78rem">"${esc(x.existing_name)}" (#${x.existing_id}, ${x.existing_status}) â€” ${x.reasons.join(', ')}</div>`;});h+=`</div>`;}
  if(d.queue_estimate)h+=`<div class="queue-chip">${esc(d.queue_estimate.message)}</div>`;
  h+=`<p style="color:var(--text-dim);font-size:.82rem;margin-top:.8rem">Still want to post? Click <strong>Post Anyway</strong> to proceed.</p>`;
  document.getElementById('warnBody').innerHTML=h;
  document.getElementById('warnModal').classList.add('show');
}
function closeWarn(){document.getElementById('warnModal').classList.remove('show');_pfd=null;const b=document.getElementById('submitBtn');b.disabled=false;b.textContent='Submit & Queue';}
async function forceSubmit(){
  if(!_pfd)return; const cb=document.getElementById('warnConfirm');cb.disabled=true;cb.innerHTML='<span class="spin white"></span>';
  try{_pfd.append('force','true');const r=await fetch(`${A}/api/tools`,{method:'POST',body:_pfd,headers:hdr()});const d=await r.json();if(!r.ok)throw new Error(d.detail||'Failed');
    closeWarn();toast(`"${d.tool_name}" queued!`);confetti();document.getElementById('frm').reset();document.getElementById('fFileName').textContent='';document.getElementById('vidPreview').style.display='none';vidMode('url');loadTools();
  }catch(e){toast(e.message,'error');}finally{cb.disabled=false;cb.textContent='Post Anyway';_pfd=null;}
}

// â”€â”€ Confetti â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function confetti(){
  const colors=['#5046e5','#059669','#d97706','#dc2626','#2563eb','#7c3aed','#ec4899'];
  for(let i=0;i<40;i++){
    const p=document.createElement('div');p.className='confetti-piece';
    p.style.cssText=`left:${Math.random()*100}vw;top:-10px;background:${colors[i%colors.length]};animation-duration:${1+Math.random()*1.5}s;animation-delay:${Math.random()*.3}s;width:${6+Math.random()*6}px;height:${6+Math.random()*6}px;border-radius:${Math.random()>.5?'50%':'2px'}`;
    document.body.appendChild(p);setTimeout(()=>p.remove(),3000);
  }
}

// â”€â”€ Progress ring SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ring(done,total,size=36){
  const r=14,c=2*Math.PI*r,pct=total?done/total:0,off=c*(1-pct);
  const color=pct===1?'var(--green)':pct>=.5?'var(--accent)':pct>0?'var(--amber)':'var(--border)';
  return `<svg class="progress-ring" width="${size}" height="${size}" viewBox="0 0 ${size} ${size}"><circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="var(--border)" stroke-width="3"/><circle cx="${size/2}" cy="${size/2}" r="${r}" fill="none" stroke="${color}" stroke-width="3" stroke-linecap="round" stroke-dasharray="${c}" stroke-dashoffset="${off}" transform="rotate(-90 ${size/2} ${size/2})"/><text x="${size/2}" y="${size/2}" text-anchor="middle" dominant-baseline="central" font-size="10" font-weight="700" fill="${color}">${done}/${total}</text></svg>`;
}

// â”€â”€ Load tools â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadTools(){
  try{
    const r=await fetch(`${A}/api/tools`,{headers:hdr()});const tools=await r.json();const box=document.getElementById('toolBox');
    if(!tools.length){box.innerHTML='<div style="text-align:center;padding:2rem;color:var(--text-dim)">No tools yet</div>';return;}
    box.innerHTML='<div class="tool-list">'+tools.map(t=>{
      const ps=['youtube','x','linkedin','instagram','facebook','telegram_channel','reddit'];
      const done=ps.filter(p=>t[p+'_status']==='SUCCESS').length;
      const failed=ps.some(p=>t[p+'_status']==='FAILED');
      return `<div class="tool-card">
        ${ring(done,ps.length)}
        <div class="tool-body">
          <div class="tool-name">${esc(t.tool_name)}</div>
          <div class="tool-meta"><span class="badge badge-${t.status.toLowerCase()}">${t.status}</span> <span>${t.posted_at?new Date(t.posted_at).toLocaleDateString():new Date(t.created_at).toLocaleDateString()}</span></div>
          <div class="tool-platforms">${ps.map(p=>{const s=t[p+'_status'];const lbl=p==='telegram_channel'?'tg':p.slice(0,2);return `<span class="plat ${s==='SUCCESS'?'plat-ok':s==='FAILED'?'plat-fail':s==='SKIPPED'?'plat-skip':'plat-wait'}">${lbl}</span>`;}).join('')}</div>
          ${t.scheduled_at&&t.status==='READY'?`<div class="tool-sched">â° ${new Date(t.scheduled_at).toLocaleString()}</div>`:''}
          ${t.error_log?`<div class="tool-error">âš  ${esc(t.error_log)}</div>`:''}
        </div>
        <div class="tool-actions">
          ${t.status==='FAILED'||failed?`<button class="btn btn-ghost btn-xs" onclick="retryTool(${t.id})" title="Retry">â†»</button>`:``}
          <button class="btn btn-red btn-xs" onclick="delTool(${t.id},'${esc(t.tool_name)}')" title="Delete">âœ•</button>
        </div>
      </div>`;
    }).join('')+'</div>';
  }catch(e){console.error(e);}
}

async function retryTool(id){try{const r=await fetch(`${A}/api/tools/${id}/retry`,{method:'POST',headers:hdr()});const d=await r.json();if(!r.ok)throw new Error(d.detail);toast(`Retrying ${d.platforms_reset} platform(s)...`);loadTools();}catch(e){toast(e.message,'error');}}
async function delTool(id,n){if(!confirm(`Delete "${n}"?`))return;try{const r=await fetch(`${A}/api/tools/${id}`,{method:'DELETE',headers:hdr()});if(!r.ok)throw new Error('Failed');toast(`"${n}" deleted`);loadTools();}catch(e){toast(e.message,'error');}}

// â”€â”€ Heatmap â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHeatmap(){
  const box=document.getElementById('heatmapBox');
  box.innerHTML='<div style="text-align:center;padding:1rem;color:var(--text-dim)"><span class="spin"></span></div>';
  try{
    const r=await fetch(`${A}/api/analytics/heatmap`,{headers:hdr()});const days=await r.json();
    if(!r.ok)throw new Error('Failed');
    // Group into weeks (columns), 7 rows each
    const weeks=[];let week=[];
    // Align start to Monday
    const startDate=new Date(days[0].date);
    const pad=startDate.getDay()===0?6:startDate.getDay()-1;
    for(let i=0;i<pad;i++)week.push(null);
    days.forEach(d=>{week.push(d);if(week.length===7){weeks.push(week);week=[];}});
    if(week.length)weeks.push(week);

    const maxC=Math.max(...days.map(d=>d.count),1);
    function lvl(c){if(c===0)return 0;if(c<=maxC*.25)return 1;if(c<=maxC*.5)return 2;if(c<=maxC*.75)return 3;return 4;}

    let html='<div class="heatmap-wrap"><div class="heatmap-title">Posting Activity (last 12 months)</div>';
    html+='<div class="heatmap">';
    weeks.forEach(w=>{
      html+='<div class="heatmap-col">';
      for(let i=0;i<7;i++){
        const d=w[i];
        if(!d){html+='<div class="heatmap-cell" style="visibility:hidden"></div>';continue;}
        const tt=d.count?`${d.date}: ${d.count} post(s)${d.tools.length?' â€” '+d.tools.join(', '):''}`:d.date+': no posts';
        html+=`<div class="heatmap-cell" data-lvl="${lvl(d.count)}" title="${esc(tt)}"></div>`;
      }
      html+='</div>';
    });
    html+='</div>';
    html+='<div class="heatmap-legend"><span>Less</span><div class="cell" style="background:var(--surface-2)"></div><div class="cell" style="background:#c7d2fe"></div><div class="cell" style="background:#818cf8"></div><div class="cell" style="background:#6366f1"></div><div class="cell" style="background:#4f46e5"></div><span>More</span></div>';
    html+='</div>';
    box.innerHTML=html;
  }catch(e){box.innerHTML='<div style="color:var(--red);text-align:center;padding:1rem">Failed to load heatmap</div>';}
}

// â”€â”€ Recent posts â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadRecent(){
  const box=document.getElementById('recentBox');
  try{
    const r=await fetch(`${A}/api/analytics`,{headers:hdr()});const d=await r.json();
    if(!d.recent||!d.recent.length){box.innerHTML='<div style="text-align:center;padding:1rem;color:var(--text-dim)">No posts yet</div>';return;}
    box.innerHTML='<div class="tool-list">'+d.recent.map(t=>{
      const ps=['youtube','x','linkedin','instagram','facebook','telegram_channel','reddit'];
      const done=ps.filter(p=>t[p+'_status']==='SUCCESS').length;
      return `<div class="tool-card"><div style="min-width:32px;text-align:center;font-size:.85rem;font-weight:700;color:var(--green)">${done}/7</div><div class="tool-body"><div class="tool-name">${esc(t.tool_name)}</div><div class="tool-meta"><span>${t.posted_at?new Date(t.posted_at).toLocaleDateString():'-'}</span></div><div class="tool-platforms">${ps.map(p=>{const s=t[p+'_status'];const lbl=p==='telegram_channel'?'tg':p.slice(0,2);return `<span class="plat ${s==='SUCCESS'?'plat-ok':s==='FAILED'?'plat-fail':s==='SKIPPED'?'plat-skip':'plat-wait'}">${lbl}</span>`;}).join('')}</div></div></div>`;
    }).join('')+'</div>';
  }catch(e){box.innerHTML='<div style="color:var(--red);text-align:center">Failed</div>';}
}

// â”€â”€ Analytics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadAnalytics(){
  const box=document.getElementById('analyticsBox');
  box.innerHTML='<div style="text-align:center;padding:2rem;color:var(--text-dim)"><span class="spin"></span></div>';
  try{
    const r=await fetch(`${A}/api/analytics`,{headers:hdr()});const d=await r.json();
    let h=`<div class="stats"><div class="stat"><div class="stat-val">${d.total}</div><div class="stat-label">Total</div></div><div class="stat"><div class="stat-val">${d.posted}</div><div class="stat-label">Posted</div></div><div class="stat"><div class="stat-val">${d.failed}</div><div class="stat-label">Failed</div></div><div class="stat"><div class="stat-val">${d.ready}</div><div class="stat-label">Queue</div></div><div class="stat"><div class="stat-val">${d.success_rate}%</div><div class="stat-label">Success</div></div></div>`;
    h+='<div style="font-size:.88rem;font-weight:700;margin-bottom:.8rem">Platform Performance</div>';
    Object.entries(d.platforms).forEach(([n,s])=>{
      const c=s.success_rate>70?'var(--green)':s.success_rate>30?'var(--amber)':'var(--red)';
      const label=n==='telegram_channel'?'Telegram':n==='x'?'X':n[0].toUpperCase()+n.slice(1);
      h+=`<div class="platform-row"><span class="name">${label}</span><div class="track"><div class="track-fill" style="width:${s.success_rate}%"></div></div><span class="rate" style="color:${c}">${s.success_rate}%</span><span style="font-size:.7rem;color:var(--text-dim);min-width:60px;text-align:right">${s.success}âœ“ ${s.failed}âœ—</span></div>`;
    });
    box.innerHTML=h;
  }catch(e){box.innerHTML='<div style="color:var(--red);text-align:center">Failed</div>';}
}

async function exportCSV(){try{const r=await fetch(`${A}/api/analytics/export`,{headers:hdr()});if(!r.ok)throw new Error('Failed');const b=await r.blob(),u=URL.createObjectURL(b),a=document.createElement('a');a.href=u;a.download=`export_${new Date().toISOString().slice(0,10)}.csv`;document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(u);toast('CSV exported!');}catch(e){toast(e.message,'error');}}

// â”€â”€ Health â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadHealth(){
  const box=document.getElementById('healthBox');
  box.innerHTML='<div style="text-align:center;padding:1rem;color:var(--text-dim)"><span class="spin"></span></div>';
  try{
    const r=await fetch(`${A}/api/health/tokens`,{headers:hdr()});const d=await r.json();
    const cards=[];const m=d.meta||{};
    if(m.configured){
      const dl=m.days_left!=null?m.days_left:(m.valid?9999:-1);
      const cls=m.valid?(dl>14?'ok':dl>3?'warn':'err'):'err';
      let det=m.valid?'âœ“ Valid':'âœ— Invalid';
      if(m.expires_at)det+=` â€” ${m.days_left} days left (${new Date(m.expires_at).toLocaleDateString()})`;
      else if(m.valid)det+=' â€” No expiry';
      if(m.scopes)det+=`<br>Scopes: ${m.scopes.join(', ')}`;
      if(m.error)det+=`<br><span style="color:var(--red)">${m.error}</span>`;
      cards.push(`<div class="health-card ${cls}"><h4>Meta (IG + FB)</h4><div class="detail">${det}</div></div>`);
    }else cards.push(`<div class="health-card"><h4>Meta (IG + FB)</h4><div class="detail">Not configured</div></div>`);

    ['linkedin','youtube','x','telegram_channel','reddit','discord','telegram','gemini'].forEach(n=>{
      const p=d[n]||{};const label=n==='x'?'X (Twitter)':n==='gemini'?'Gemini AI':n==='telegram_channel'?'Telegram Channel':n==='telegram'?'Telegram Bot':n==='reddit'?'Reddit':n[0].toUpperCase()+n.slice(1);
      cards.push(`<div class="health-card ${p.configured?'ok':''}"><h4>${label}</h4><div class="detail">${p.configured?'âœ“ Configured':'Not configured'}</div></div>`);
    });
    box.innerHTML=`<div class="health-grid">${cards.join('')}</div>`;
  }catch(e){box.innerHTML='<div style="color:var(--red);text-align:center">Failed</div>';}
}

// â”€â”€ Platform Limits â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadLimits(){
  try{
    const r=await fetch(`${A}/api/platform-limits`,{headers:hdr()});const d=await r.json();
    let h='<div class="limits-inline">';
    for(const[k,l]of Object.entries(d)){
      const dur=l.max_duration_sec<60?l.max_duration_sec+'s':`${Math.floor(l.max_duration_sec/60)}m`;
      const sz=l.max_size_mb>=1024?(l.max_size_mb/1024|0)+' GB':l.max_size_mb+' MB';
      h+=`<div class="limit-chip"><strong>${l.label}</strong><span>Max ${dur} Â· ${sz} Â· ${l.recommended_aspect}</span></div>`;
    }
    h+='</div>';document.getElementById('limitsBox').innerHTML=h;
  }catch(e){}
}

// â”€â”€ Schedule suggestions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadSched(){
  const box=document.getElementById('schedBox');
  box.innerHTML='<div style="text-align:center;padding:1rem;color:var(--text-dim)"><span class="spin"></span></div>';
  try{
    const r=await fetch(`${A}/api/schedule/suggest`,{headers:hdr()});const d=await r.json();
    let h='';
    if(d.queue_size>0)h+=`<div class="queue-chip" style="margin-bottom:.5rem">${d.queue_size} in queue</div>`;
    h+='<ul class="sched-list">';
    d.suggestions.forEach(s=>{
      const dt=new Date(s.suggested_time);
      const ts=dt.toLocaleString(undefined,{weekday:'short',month:'short',day:'numeric',hour:'2-digit',minute:'2-digit'});
      h+=`<li class="sched-item ${s.is_prime_time?'prime':''}" onclick="useSched('${s.suggested_time}')"><span class="sched-time">${ts}</span><span class="sched-plat">${s.platform}</span><span class="sched-reason">${esc(s.reason)}</span>${s.is_prime_time?'<span style="color:var(--green);font-size:.68rem;font-weight:700">PRIME</span>':''}</li>`;
    });
    h+='</ul><div style="font-size:.7rem;color:var(--text-dim);margin-top:.4rem">Click to auto-fill schedule</div>';
    box.innerHTML=h;
  }catch(e){box.innerHTML='<div style="color:var(--red);text-align:center;padding:.5rem">Failed</div>';}
}
function useSched(iso){
  const dt=new Date(iso),loc=new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString().slice(0,16);
  document.getElementById('fSched').value=loc;
  toast('Schedule set â€” submit your tool to use it','warning');
  window.scrollTo({top:0,behavior:'smooth'});
}

// â”€â”€ Bulk upload â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function bulkUp(){
  const btn=document.getElementById('bulkBtn'),res=document.getElementById('bulkRes'),raw=document.getElementById('bulkJson').value.trim();
  if(!raw){toast('Paste JSON first','error');return;}
  let tools;try{tools=JSON.parse(raw);}catch{toast('Invalid JSON','error');return;}
  if(!Array.isArray(tools)){toast('Must be an array','error');return;}
  btn.disabled=true;btn.innerHTML='<span class="spin white"></span> Uploading...';
  try{
    const r=await fetch(`${A}/api/tools/bulk`,{method:'POST',headers:{...hdr(),'Content-Type':'application/json'},body:JSON.stringify(tools)});
    const d=await r.json();if(!r.ok)throw new Error(d.detail);
    let h=`<span style="color:var(--green);font-weight:700">âœ“ ${d.total} tool(s) created</span>`;
    if(d.errors&&d.errors.length){h+=`<br><span style="color:var(--red)">${d.errors.length} error(s):</span><ul style="padding-left:1rem;margin-top:.2rem">`;d.errors.forEach(e=>{h+=`<li style="color:var(--red);font-size:.76rem">Row ${e.index}: ${e.error}</li>`;});h+='</ul>';}
    res.innerHTML=h;toast(`${d.total} tool(s) uploaded!`);confetti();loadTools();
  }catch(e){toast(e.message,'error');}
  finally{btn.disabled=false;btn.textContent='Upload All';}
}

// â”€â”€ Auto refresh â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(loadTools,30000);
</script>
</body>
</html>
